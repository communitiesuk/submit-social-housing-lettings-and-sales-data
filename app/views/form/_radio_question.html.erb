<%= render partial: "form/guidance/#{question.guidance_partial}" if question.guidance_partial %>

<%= f.govuk_radio_buttons_fieldset question.id.to_sym,
    caption: caption && !page_header.present? ? { text: caption.html_safe, size: "l" } : nil,
    legend: { text: question.header.html_safe, size: !page_header.present? ? "l" : "m", tag: !page_header.present? ? "h1" : "h2" },
    hint: { text: question.hint_text&.html_safe } do %>

    <% question.answer_options.map do |key, val| %>
      <% if key.starts_with?("divider") %>
        <%= f.govuk_radio_divider %>
      <% else %>
        <%= f.govuk_radio_button question.id, val, label: { text: val }, **stimulus_html_attributes(question) do %>
          <% conditional_key = question.conditional_for&.find { |_, cval| cval.include? val }&.first %>
          <% if conditional_key %>
            <% conditional_question = @page.questions.find { |q| q.id == conditional_key } %>
            <%= render partial: "#{conditional_question.type}_question", locals: { question: conditional_question, caption: caption, page_header: page_header, f: f } %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
<% end %>
